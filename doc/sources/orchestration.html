<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html>
<head>
<link rel="Stylesheet" type="text/css" href="../cludg.css"/>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"/>
<title>
orchestration</title>
</head>
<body>
<div id="navbar">
<table cellspacing="0" cellpadding="0" border="0" style="width: 100%;">
<colgroup span="3">
<col width="0*"/>
<col width="0*"/>
<col width="1*"/>
</colgroup>
<tr>
<td align="left" valign="baseline">
<a href="form.html">
Prev:&nbsp;form</a>
<br/>
</td>
<td>
&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td align="left" valign="baseline">
<span class="upchain">
<b>
orchestration</b>
<br/>
<a href="../index.html">
Index</a>
</span>
&nbsp;&nbsp;&nbsp;&nbsp;</td>
</tr>
</table>
</div>
<div class="cludg-doc-body">
<h2>
orchestration
</h2>
<table style="width: 100%;" class="summary-table">
<tr class="table-heading-color">
<th class="summary" colspan="2">
Function summary</th>
</tr>
<tr class="table-row-color">
<td class="summary-name">
<a href="orchestration.html#_g181320">
append-parts</a>
</td>
<td class="summary">
<em>&amp;rest</em> scores</td>
</tr>
<tr class="table-row-color">
<td class="summary-name">
<a href="orchestration.html#_g181331">
corresponding-rest</a>
</td>
<td class="summary">
event</td>
</tr>
<tr class="table-row-color">
<td class="summary-name">
<a href="orchestration.html#_g181330">
filter-notes-if</a>
</td>
<td class="summary">
test omn <em>&amp;key</em> (remain t) (section nil)</td>
</tr>
<tr class="table-row-color">
<td class="summary-name">
<a href="orchestration.html#_g181318">
generate-parts</a>
</td>
<td class="summary">
fn part-args <em>&amp;key</em> (shared-args nil)</td>
</tr>
<tr class="table-row-color">
<td class="summary-name">
<a href="orchestration.html#_g181322">
get-instruments</a>
</td>
<td class="summary">
score</td>
</tr>
<tr class="table-row-color">
<td class="summary-name">
<a href="orchestration.html#_g181323">
get-part-omn</a>
</td>
<td class="summary">
instrument score</td>
</tr>
<tr class="table-row-color">
<td class="summary-name">
<a href="orchestration.html#_g181324">
get-parts</a>
</td>
<td class="summary">
score</td>
</tr>
<tr class="table-row-color">
<td class="summary-name">
<a href="orchestration.html#_g181334">
insert-articulation</a>
</td>
<td class="summary">
flat-omn-list <em>&amp;rest</em> articulations</td>
</tr>
<tr class="table-row-color">
<td class="summary-name">
<a href="orchestration.html#_g181317">
map-parts</a>
</td>
<td class="summary">
score fn part-args <em>&amp;key</em> (parameter nil) (shared-args nil)</td>
</tr>
<tr class="table-row-color">
<td class="summary-name">
<a href="orchestration.html#_g181321">
mix-parts</a>
</td>
<td class="summary">
<em>&amp;rest</em> scores</td>
</tr>
<tr class="table-row-color">
<td class="summary-name">
<a href="orchestration.html#_g181316">
preview-score</a>
</td>
<td class="summary">
score <em>&amp;key</em> (name 'test-score) (instruments *default-preview-score-instruments*) (header *default-preview-score-header*)</td>
</tr>
<tr class="table-row-color">
<td class="summary-name">
<a href="orchestration.html#_g181328">
remove-part</a>
</td>
<td class="summary">
instrument score</td>
</tr>
<tr class="table-row-color">
<td class="summary-name">
<a href="orchestration.html#_g181329">
remove-parts</a>
</td>
<td class="summary">
instruments score</td>
</tr>
<tr class="table-row-color">
<td class="summary-name">
<a href="orchestration.html#_g181335">
remove-unless-parameters</a>
</td>
<td class="summary">
flat-omn-list parameter <em>&amp;key</em> (remove-non-matching? nil)</td>
</tr>
<tr class="table-row-color">
<td class="summary-name">
<a href="orchestration.html#_g181325">
replace-instruments</a>
</td>
<td class="summary">
new old score</td>
</tr>
<tr class="table-row-color">
<td class="summary-name">
<a href="orchestration.html#_g181326">
replace-part-omn</a>
</td>
<td class="summary">
instrument new-part score</td>
</tr>
<tr class="table-row-color">
<td class="summary-name">
<a href="orchestration.html#_g181333">
separate-parts</a>
</td>
<td class="summary">
sequence articulation-sets</td>
</tr>
<tr class="table-row-color">
<td class="summary-name">
<a href="orchestration.html#_g181327">
split-part</a>
</td>
<td class="summary">
instrument orig-score score-to-insert</td>
</tr>
<tr class="table-row-color">
<td class="summary-name">
<a href="orchestration.html#_g181319">
_append-two-parts</a>
</td>
<td class="summary">
score1 score2</td>
</tr>
<tr class="table-row-color">
<td class="summary-name">
<a href="orchestration.html#_g181332">
_push-event-and-rests</a>
</td>
<td class="summary">
event matching-position result-omns articulation-sets-length</td>
</tr>
</table>
<div class="defparam">
<div class="defunsignatures">
<a id="_g181313">
</a>
<table cellpadding="0" cellspacing="0" width="100%">
<colgroup span="3">
<col width="0*"/>
<col width="1*"/>
<col width="0*"/>
</colgroup>
<tbody>
<tr>
<td class="symbol-name">
*default-preview-score-instruments*&nbsp;&nbsp;</td>
<td class="lambda-list">
</td>
<td class="symbol-type">
&nbsp;[Variable]</td>
</tr>
</tbody>
</table>
</div>
<div class="doc-body">
<p>
Settings for each instrument used by `preview-score'. The format is a plist where keys are the instrument labels, and values a list with the actual settings. For format of these settings are the same as instrument settings for `def-score' with keywords like <span class="keyword">
:sound, </span>
<span class="keyword">
:channel </span>
etc. -- except for they key <span class="keyword">
:omn. </span>

 </p>
</div>
</div>
<div class="defparam">
<div class="defunsignatures">
<a id="_g181314">
</a>
<table cellpadding="0" cellspacing="0" width="100%">
<colgroup span="3">
<col width="0*"/>
<col width="1*"/>
<col width="0*"/>
</colgroup>
<tbody>
<tr>
<td class="symbol-name">
*default-preview-score-header*&nbsp;&nbsp;</td>
<td class="lambda-list">
</td>
<td class="symbol-type">
&nbsp;[Variable]</td>
</tr>
</tbody>
</table>
</div>
<div class="doc-body">
<p>
Global score settings used by `preview-score'. The format is a plist where keys are the instrument labels, and values a list with the actual settings. The format is the same as the header settings for `def-score' with keywords like <span class="keyword">
:title, </span>
<span class="keyword">
:key-signature </span>
etc. 
 </p>
</div>
</div>
<div class="defparam">
<div class="defunsignatures">
<a id="_g181315">
</a>
<table cellpadding="0" cellspacing="0" width="100%">
<colgroup span="3">
<col width="0*"/>
<col width="1*"/>
<col width="0*"/>
</colgroup>
<tbody>
<tr>
<td class="symbol-name">
*preview-score-return-value*&nbsp;&nbsp;</td>
<td class="lambda-list">
</td>
<td class="symbol-type">
&nbsp;[Variable]</td>
</tr>
</tbody>
</table>
</div>
<div class="doc-body">
<p>
Controls the return value of function preview-score. 
 </p>
<p>
Possible values are 
 </p>
<ul>
<li>
<p>
<span class="keyword">
:headerless-score </span>
- the input score to preview-score 
 </p>
</li>
<li>
<p>
<span class="keyword">
:full-score </span>
- the full def-score expression generated 
 </p>
</li>
<li>
<p>
<span class="keyword">
:score </span>
- the resulting score object 
 </p>
</li>
</ul>
</div>
</div>
<div class="defun">
<div class="defunsignatures">
<a id="_g181316">
</a>
<table cellpadding="0" cellspacing="0" width="100%">
<colgroup span="3">
<col width="0*"/>
<col width="1*"/>
<col width="0*"/>
</colgroup>
<tbody>
<tr>
<td class="symbol-name">
preview-score&nbsp;&nbsp;</td>
<td class="lambda-list">
score <em>&amp;key</em> (name 'test-score) (instruments *default-preview-score-instruments*) (header *default-preview-score-header*)</td>
<td class="symbol-type">
&nbsp;[Function]</td>
</tr>
</tbody>
</table>
</div>
<div class="doc-body">
<p>
Notates and plays a score in a format slightly simpler than expected by def-score, i.e., without its header. 
 
 Args: 
 </p>
<ul>
<li>
<p>
score (plist): a headerless score. See below for its format. 
 </p>
</li>
<li>
<p>
name (symbol): The score name. 
 </p>
</li>
<li>
<p>
instruments (plist): Keys are instrument labels, and values a list with the actual settings. These settings have the same format as instrument settings for `def-score' with keywords like <span class="keyword">
:sound, </span>
<span class="keyword">
:channel </span>
etc. -- except for they key <span class="keyword">
:omn. </span>

 </p>
</li>
<li>
<p>
header (plist): The format is the same as the header settings for `def-score' with keywords like <span class="keyword">
:title, </span>
<span class="keyword">
:composer, </span>
<span class="keyword">
:key-signature </span>
etc. 
 
 </p>
</li>
</ul>
<p>
Score format: 
 </p>
<pre>
    (&lt;part1-name-keyword&gt; &lt;part1-OMN&gt; 
      &lt;part2-name-keyword&gt; &lt;part2-OMN&gt; 
      ...)  </pre>
<p>

 Example: 
 </p>
<p>
</p>
<pre>
    (preview-score 
      '(:vln ((q g4) (q. c5 e d5 q e5 f5) (h. e5)) 
        :vlc ((q g3) (q c4 b3 a3 g3) (h. c3))) 
      :instruments '(:vln (:program 'violin :sound 'gm) 
     	            :vlc (:program 'cello :sound 'gm)) 
      :header '(:title &quot;Opus magnum&quot; 
     	       :tempo 80)) </pre>
<p>
The return value is controlled by {defparameter *preview-score-return-value*}. 
 </p>
<p>
BUG: cannot specify score layout as header argument. 
 
 </p>
</div>
</div>
<div class="defun">
<div class="defunsignatures">
<a id="_g181317">
</a>
<table cellpadding="0" cellspacing="0" width="100%">
<colgroup span="3">
<col width="0*"/>
<col width="1*"/>
<col width="0*"/>
</colgroup>
<tbody>
<tr>
<td class="symbol-name">
map-parts&nbsp;&nbsp;</td>
<td class="lambda-list">
score fn part-args <em>&amp;key</em> (parameter nil) (shared-args nil)</td>
<td class="symbol-type">
&nbsp;[Function]</td>
</tr>
</tbody>
</table>
</div>
<div class="doc-body">
<p>
Create or transform a polyphonic score. The original purpose is for creating/transforming musical textures, i.e., relations between polyphonic parts. 
 </p>
<p>
Applies function `fn' to parts in `score': this function is a variant of the standard Lisp function `mapcar', but specialised for scores. A score is represented in the format discussed in the documentation of the function `preview-score'. 
 
 Additional arguments for `fn' can be specified in `part-args', and these argument lists can be different for each part. However, one argument is the part of the score. This argument is marked by an underscore (_) in the argument lists. In the following example, the function `pitch-transpose' is applied to a score with two parts. This function has two required arguments, a transposition interval (measured in semitones), and the pitch sequence or OMN to transpose. The transposition interval for the first part is 4 (major third upwards), and the underscore marks the position of the violin part to transpose, etc. 
 
 </p>
<pre>
    (map-parts '(:vln ((h e4))  
     	     :vlc ((h c3)))  
     	   #'pitch-transpose   
     	   '(:vln (4 _)   
     	     :vlc (12 _))) </pre>
<p>
Args: 
 </p>
<ul>
<li>
<p>
score (headerless score): See <a href="orchestration.html#_g181316">
preview-score</a>
for format description. 
 </p>
</li>
<li>
<p>
fn: A function that expects and returns an OMN sequence or a sequence of parameter values (e.g., lengths, or pitches) as specified in the argument `parameter'. 
 </p>
</li>
<li>
<p>
part-args (plist): Alternating instrument keywords (same as in `score') followed by arguments list for `fn' for that instrument/part. If arguments is <span class="keyword">
:skip, </span>
then that part is returned unchanged. 
 </p>
</li>
<li>
<p>
parameter (omn parameter, e.g., <span class="keyword">
:length </span>
or <span class="keyword">
:pitch, </span>
default nil means processing full OMN expression): If `fn' expects only single parameter to process, then it can be set here. 
 </p>
</li>
<li>
<p>
shared-args (list): For all instruments/parts, these arguments are appended at end end of its part-specific arguments. They are useful, e.g., for keyword arguments. 
 </p>
</li>
</ul>
<p>

 Examples: 
 </p>
<p>
Metric shifting of parts (see {defun metric-shift}). 
 </p>
<p>
</p>
<pre>
    (map-parts '(:vln ((q g4) (q. c5 e d5 q e5 f5) (h. e5)) 
                  :vlc ((q g3) (q c4 b3 a3 g3) (h. c3))) 
                 #'metric-shift 
                 '(:vln (-q _) 
                   :vlc (-h _) 
                  )) </pre>
<p>
An OMN expression to use by several further examples below. 
 </p>
<p>
</p>
<pre>
    (setf material '((-3h fs4 pp eb4 &lt;) (q e4 &lt; fs4 &lt;) (3h gs4 mp&gt; a4 &gt; bb4 &gt;) (q a4 pp -) (-5h - g4 pp leg eb4 &lt; leg d4 &lt; leg) (q bb4 &lt; e4 &lt;) (5h g4 mp&gt; leg b4 &gt; leg a4 &gt; leg bb4 &gt; leg d4 &gt; leg) (q gs4 pp -))) </pre>
<p>
A strict canon formed with the given material (without any counterpoint rules <span class="keyword">
:) </span>
For different parts the material is metrically shifted and transposed. 
 </p>
<p>
Note also that map-parts calls can be nested. 
 </p>
<p>
</p>
<pre>
    (map-parts  
       (map-parts `(:vl1 ,material 
                    :vl2 ,material   
                    :vla ,material 
                    :vlc ,material) 
                  #'metric-shift  
                  '(:vl1 :skip ;; leave part unchanged 
                    :vl2 (-q _)   
                    :vla (-h _) 
                    :vlc (-h. _))) 
       #'pitch-transpose 
       '(:vl1 (6 _)  
         :vl2 (4 _)   
         :vla (2 _) 
         :vlc :skip)   
       ) </pre>
<p>
Simple homorhythmic texture created by randomised transpositions. Each part shares a similar overall pitch profile. 
 </p>
<p>
Note that calls can be more concise with a (lambda) function that nests calls to transformation functions -- instead of nesting map-parts as shown above. 
 </p>
<p>
</p>
<pre>
    (map-parts `(:vl1 ,material 
                  :vl2 ,material   
     	     :vla ,material 
     	     :vlc ,material) 
     	   #'(lambda (transpose seq) 
     	       ;; static transposition for moving parts into different registers 
     	       (pitch-transpose  
     		transpose  
     		;; randomised transposition of notes in parts 
     		(pitch-transpose-n (rnd 10 :low -2 :high 2) seq))) 
     	   '(:vl1 (7 _)  
     	     :vl2 (0 _)   
     	     :vla (-10 _) 
     	     :vlc (-20 _))) </pre>
<p>
Homophonic texture created by random pitch variants (retrograde, inversion etc.). The global pitch profiles of parts differ here, in contrast to the previous example. 
 </p>
<p>
</p>
<pre>
    (map-parts  
       `(:vl1 ,material 
         :vl2 ,material   
         :vla ,material 
         :vlc ,material) 
       #'pitch-variant  
       `(:vl1 (_ :transpose 7 :seed 10)  
         :vl2 (_ :transpose 0 :seed 20)   
         :vla (_ :transpose -10 :seed 30) 
         :vlc (_ :transpose -20 :seed 40)) 
        :shared-args '(:variant ?)) </pre>
<p>

 </p>
</div>
</div>
<div class="defun">
<div class="defunsignatures">
<a id="_g181318">
</a>
<table cellpadding="0" cellspacing="0" width="100%">
<colgroup span="3">
<col width="0*"/>
<col width="1*"/>
<col width="0*"/>
</colgroup>
<tbody>
<tr>
<td class="symbol-name">
generate-parts&nbsp;&nbsp;</td>
<td class="lambda-list">
fn part-args <em>&amp;key</em> (shared-args nil)</td>
<td class="symbol-type">
&nbsp;[Function]</td>
</tr>
</tbody>
</table>
</div>
<div class="doc-body">
<p>
Generate multiple parts of a polyphonic score by calling a function returning musical material multiple times for multiple parts. 
 
 Returns a headerless score. <a href="orchestration.html#_g181316">
preview-score</a>
describes this format. 
 </p>
<p>
Args: 
 </p>
<ul>
<li>
<p>
fn: A function returning an OMN sequence or a sequence of lengths. 
 </p>
</li>
<li>
<p>
part-args (plist): Alternating instrument keywords followed by arguments list for `fn' for that instrument/part. 
 </p>
</li>
<li>
<p>
shared-args (list): For all instruments/parts, these arguments are appended at end end of its part-specific arguments. They are useful, e.g., for keyword arguments. 
 
 
 Examples: 
 </p>
</li>
</ul>
<p>
A random rhythm generated by calling gen-white-noise and vector-to-length with different arguments for different parts. 
 </p>
<pre>
    (generate-parts 
       #'(lambda (n length low high)  
           (vector-to-length length low high (gen-white-noise n))) 
       '(:vln (10 1/12 1 4) 
         :vlc (12 1/16 1 4))) </pre>
<p>
A random rhythm using seed and shared arguments. 
 </p>
<pre>
    (generate-parts 
       #'(lambda (seed n length low high)  
           (vector-to-length length low high (gen-white-noise n :seed seed))) 
       '(:vln (1) 
         :vlc (2)) 
       :shared-args '(10 1/12 1 4)) </pre>
<p>
NOTE: A polyphonic score of only pitches or other parameters without lengths can be generated, but not previewed. 
 </p>
<p>
</p>
<pre>
    (preview-score 
      (generate-parts 
       #'(lambda (n range)  
           (vector-to-pitch range (gen-white-noise n))) 
       '(:vln (10 (a3 a4)) 
         :vlc (12 (g2 c4))))) 
     &gt; Error: No length specified before first pitch  </pre>
</div>
</div>
<div class="defun">
<div class="defunsignatures">
<a id="_g181319">
</a>
<table cellpadding="0" cellspacing="0" width="100%">
<colgroup span="3">
<col width="0*"/>
<col width="1*"/>
<col width="0*"/>
</colgroup>
<tbody>
<tr>
<td class="symbol-name">
_append-two-parts&nbsp;&nbsp;</td>
<td class="lambda-list">
score1 score2</td>
<td class="symbol-type">
&nbsp;[Function]</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="defun">
<div class="defunsignatures">
<a id="_g181320">
</a>
<table cellpadding="0" cellspacing="0" width="100%">
<colgroup span="3">
<col width="0*"/>
<col width="1*"/>
<col width="0*"/>
</colgroup>
<tbody>
<tr>
<td class="symbol-name">
append-parts&nbsp;&nbsp;</td>
<td class="lambda-list">
<em>&amp;rest</em> scores</td>
<td class="symbol-type">
&nbsp;[Function]</td>
</tr>
</tbody>
</table>
</div>
<div class="doc-body">
<p>
Concatenate multiple scores so that they form a sequence in the resulting score. The OMN expression of instruments that are shared between input scores are appended, while instruments that are missing in some input score are padded with rests for the duration of that score. 
 </p>
<p>
Note that the function assumes all parts in each score to contain the same overall duration and metric structure. 
 </p>
<p>
Args: 
 </p>
<ul>
<li>
<p>
scores: see <a href="orchestration.html#_g181316">
preview-score</a>
for format description of headerless scores. 
 </p>
</li>
</ul>
<p>
Example: 
 </p>
<p>
</p>
<pre>
    (setf material '((-3h fs4 pp eb4 &lt;) (q e4 &lt; fs4 &lt;) (3h gs4 mp&gt; a4 &gt; bb4 &gt;) (q a4 pp -))) 
          
     (append-parts `(:vl1 ,material 
                     :vl2 ,(gen-retrograde material :flatten T)) 
                   `(:vl1 ,material 
                     :vlc ,(gen-retrograde material :flatten T)) 
                   `(:vl2 ,material 
                     :vlc ,(gen-retrograde material :flatten T))) </pre>
</div>
</div>
<div class="defun">
<div class="defunsignatures">
<a id="_g181321">
</a>
<table cellpadding="0" cellspacing="0" width="100%">
<colgroup span="3">
<col width="0*"/>
<col width="1*"/>
<col width="0*"/>
</colgroup>
<tbody>
<tr>
<td class="symbol-name">
mix-parts&nbsp;&nbsp;</td>
<td class="lambda-list">
<em>&amp;rest</em> scores</td>
<td class="symbol-type">
&nbsp;[Function]</td>
</tr>
</tbody>
</table>
</div>
<div class="doc-body">
<p>
Mix multiple scores together to run in parallel. Useful, e.g., for creating melody and polyphonic accompaniment or different textures separately, and then mixing them together. 
 </p>
<p>
Args 
 </p>
<ul>
<li>
<p>
scores: see <a href="orchestration.html#_g181316">
preview-score</a>
for format description of headerless scores. 
 </p>
</li>
</ul>
<p>
Example: 
 </p>
<p>
</p>
<pre>
    (let ((material '((-3h fs4 pp eb4 &lt;) (q e4 &lt; fs4 &lt;) (3h gs4 mp&gt; a4 &gt; bb4 &gt;) (q a4 pp -)))) 
        (mix-parts `(:vln ,material) 
                   `(:vlc ,(metric-shift '-h material)))) </pre>
</div>
</div>
<div class="defun">
<div class="defunsignatures">
<a id="_g181322">
</a>
<table cellpadding="0" cellspacing="0" width="100%">
<colgroup span="3">
<col width="0*"/>
<col width="1*"/>
<col width="0*"/>
</colgroup>
<tbody>
<tr>
<td class="symbol-name">
get-instruments&nbsp;&nbsp;</td>
<td class="lambda-list">
score</td>
<td class="symbol-type">
&nbsp;[Function]</td>
</tr>
</tbody>
</table>
</div>
<div class="doc-body">
<p>
Returns all instruments of `score', a headerless score (see <a href="orchestration.html#_g181316">
preview-score</a>
for its format). 
 </p>
</div>
</div>
<div class="defun">
<div class="defunsignatures">
<a id="_g181323">
</a>
<table cellpadding="0" cellspacing="0" width="100%">
<colgroup span="3">
<col width="0*"/>
<col width="1*"/>
<col width="0*"/>
</colgroup>
<tbody>
<tr>
<td class="symbol-name">
get-part-omn&nbsp;&nbsp;</td>
<td class="lambda-list">
instrument score</td>
<td class="symbol-type">
&nbsp;[Function]</td>
</tr>
</tbody>
</table>
</div>
<div class="doc-body">
<p>
Returns the part (OMN expression) of `instrument' in `score', a headerless score (see <a href="orchestration.html#_g181316">
preview-score</a>
for its format). 
 </p>
</div>
</div>
<div class="defun">
<div class="defunsignatures">
<a id="_g181324">
</a>
<table cellpadding="0" cellspacing="0" width="100%">
<colgroup span="3">
<col width="0*"/>
<col width="1*"/>
<col width="0*"/>
</colgroup>
<tbody>
<tr>
<td class="symbol-name">
get-parts&nbsp;&nbsp;</td>
<td class="lambda-list">
score</td>
<td class="symbol-type">
&nbsp;[Function]</td>
</tr>
</tbody>
</table>
</div>
<div class="doc-body">
<p>
Returns a list of all OMN parts of `score', a headerless score (see <a href="orchestration.html#_g181316">
preview-score</a>
for its format). 
 </p>
</div>
</div>
<div class="defun">
<div class="defunsignatures">
<a id="_g181325">
</a>
<table cellpadding="0" cellspacing="0" width="100%">
<colgroup span="3">
<col width="0*"/>
<col width="1*"/>
<col width="0*"/>
</colgroup>
<tbody>
<tr>
<td class="symbol-name">
replace-instruments&nbsp;&nbsp;</td>
<td class="lambda-list">
new old score</td>
<td class="symbol-type">
&nbsp;[Function]</td>
</tr>
</tbody>
</table>
</div>
<div class="doc-body">
<p>
Replaces old instruments by new instruments in a score. 
 </p>
<p>
Args: 
 </p>
<ul>
<li>
<p>
new (list of keywords): New instruments to use. 
 </p>
</li>
<li>
<p>
old (list of keywords): List of instruments in `score' to be replaced. Must have same length as `new'. 
 </p>
</li>
<li>
<p>
score (a headerless score): See <a href="orchestration.html#_g181316">
preview-score</a>
for its format. 
 </p>
</li>
</ul>
<p>
Example: 
 </p>
<p>
</p>
<pre>
    (replace-instruments '(:trp :trb) '(:vl2 :vlc) 
     '(:vl1 (h g4) 
       :vl2 (h e4) 
       :vla (h c4) 
       :vlc (h c3))) </pre>
</div>
</div>
<div class="defun">
<div class="defunsignatures">
<a id="_g181326">
</a>
<table cellpadding="0" cellspacing="0" width="100%">
<colgroup span="3">
<col width="0*"/>
<col width="1*"/>
<col width="0*"/>
</colgroup>
<tbody>
<tr>
<td class="symbol-name">
replace-part-omn&nbsp;&nbsp;</td>
<td class="lambda-list">
instrument new-part score</td>
<td class="symbol-type">
&nbsp;[Function]</td>
</tr>
</tbody>
</table>
</div>
<div class="doc-body">
<p>
Replaces the part (OMN expression) of `instrument' in `score' with `new-part'. 
 </p>
<p>
Example: 
 </p>
<p>
</p>
<pre>
    (replace-part-omn  :vlc 
      '((h g3)) 
      '(:vln ((h e4)) 
        :vlc ((h c3)))) </pre>
</div>
</div>
<div class="defun">
<div class="defunsignatures">
<a id="_g181327">
</a>
<table cellpadding="0" cellspacing="0" width="100%">
<colgroup span="3">
<col width="0*"/>
<col width="1*"/>
<col width="0*"/>
</colgroup>
<tbody>
<tr>
<td class="symbol-name">
split-part&nbsp;&nbsp;</td>
<td class="lambda-list">
instrument orig-score score-to-insert</td>
<td class="symbol-type">
&nbsp;[Function]</td>
</tr>
</tbody>
</table>
</div>
<div class="doc-body">
<p>
Replaces part of `instrument' in `orig-score' with `score-to-insert'. 
 </p>
<p>
Example: 
 </p>
<p>
</p>
<pre>
    (split-part :vl2 
     '(:vl1 (h g4) 
       :vl2 (h e4) 
       :vla (h c4) 
       :vlc (h c3)) 
      '(:vl2_div1 (h f4) 
        :vl2_div2 (h e4))) </pre>
<p>
Split divisi strings into parts 
 </p>
<p>
(setf my-score 
 '(:vl1 (h g4b4 g4a4) 
 <span class="keyword">
:vl2 </span>
(h e4 d4) 
 <span class="keyword">
:vla </span>
(h c4 b3) 
 <span class="keyword">
:vlc </span>
(h c3 g3))) 
 </p>
<p>
(setf divisi-part (single-events (pitch-melodize (get-part-omn <span class="keyword">
:vl1 </span>
my-score)))) 
 </p>
<p>
(preview-score 
 (split-part <span class="keyword">
:vl1 </span>

 my-score 
 `(:vl1_div1 ,(flatten (tu:at-even-position divisi-part)) 
 <span class="keyword">
:vl1_div2 </span>
,(flatten (tu:at-odd-position divisi-part))))) 
 </p>
</div>
</div>
<div class="defun">
<div class="defunsignatures">
<a id="_g181328">
</a>
<table cellpadding="0" cellspacing="0" width="100%">
<colgroup span="3">
<col width="0*"/>
<col width="1*"/>
<col width="0*"/>
</colgroup>
<tbody>
<tr>
<td class="symbol-name">
remove-part&nbsp;&nbsp;</td>
<td class="lambda-list">
instrument score</td>
<td class="symbol-type">
&nbsp;[Function]</td>
</tr>
</tbody>
</table>
</div>
<div class="doc-body">
<p>
Removes `instrument' and its OMN expression from `score'. 
 </p>
<p>
Example: 
 </p>
<p>
(remove-part <span class="keyword">
:vl2 </span>

 '(:vl1 (h g4) 
 <span class="keyword">
:vl2 </span>
(h e4) 
 <span class="keyword">
:vla </span>
(h c4) 
 <span class="keyword">
:vlc </span>
(h c3))) 
 </p>
</div>
</div>
<div class="defun">
<div class="defunsignatures">
<a id="_g181329">
</a>
<table cellpadding="0" cellspacing="0" width="100%">
<colgroup span="3">
<col width="0*"/>
<col width="1*"/>
<col width="0*"/>
</colgroup>
<tbody>
<tr>
<td class="symbol-name">
remove-parts&nbsp;&nbsp;</td>
<td class="lambda-list">
instruments score</td>
<td class="symbol-type">
&nbsp;[Function]</td>
</tr>
</tbody>
</table>
</div>
<div class="doc-body">
<p>
Removes all `instruments' and their OMN expressions from `score'. 
 </p>
<p>
Example: 
 </p>
<p>
</p>
<pre>
    (remove-parts '(:vl1 :vl2) 
     '(:vl1 (h g4) 
       :vl2 (h e4) 
       :vla (h c4) 
       :vlc (h c3))) </pre>
</div>
</div>
<div class="defun">
<div class="defunsignatures">
<a id="_g181330">
</a>
<table cellpadding="0" cellspacing="0" width="100%">
<colgroup span="3">
<col width="0*"/>
<col width="1*"/>
<col width="0*"/>
</colgroup>
<tbody>
<tr>
<td class="symbol-name">
filter-notes-if&nbsp;&nbsp;</td>
<td class="lambda-list">
test omn <em>&amp;key</em> (remain t) (section nil)</td>
<td class="symbol-type">
&nbsp;[Function]</td>
</tr>
</tbody>
</table>
</div>
<div class="doc-body">
<p>
Extracts events in OMN for which a given test function returns true (or keeps only events for which the test function returns nils). All other notes are turned into rests. 
 </p>
<p>
Args: 
 </p>
<ul>
<li>
<p>
test: Boolean function expecting individual parameters of each note in `OMN' 
 </p>
</li>
<li>
<p>
OMN: An OMN sequence 
 </p>
</li>
<li>
<p>
remain: Boolean expressing whether only matching notes (T) or non-matching notes (nil) should be kept. 
 </p>
</li>
<li>
<p>
section: an integer or list of integers. Selected list or lists to process. The default is NIL. 
 </p>
</li>
</ul>
<p>
See also Opusmodus builtin `filter-events'. 
 </p>
<p>
Examples: 
 </p>
<p>
Keep only notes above middle C and turn other notes into rests 
 </p>
<p>
</p>
<pre>
    (filter-notes-if #'(lambda (dur pitch &amp;rest other-args)  
                          (&gt; (pitch-to-midi pitch) 60)) 
                      '(e c4 mp -e fermata e. d4 -h e. c4 e e4)) </pre>
<p>
Do the opposite with <span class="keyword">
:remain </span>
nil. 
 </p>
<p>
</p>
<pre>
    (filter-notes-if #'(lambda (dur pitch &amp;rest other-args)  
                          (&gt; (pitch-to-midi pitch) 60)) 
                      '(e c4 mp -e fermata e. d4 -h e. c4 e e4) 
                      :remain nil) </pre>
<p>
This also works with nested lists and you can process only selected bars (other bars are kept unchanged). 
 </p>
<p>
</p>
<pre>
    (filter-notes-if #'(lambda (dur pitch &amp;rest other-args)  
                          (&gt; (pitch-to-midi pitch) 60)) 
                      '((e c4 mp -e fermata e. d4 -s) (-q.. e. c4 e e4)) 
                      :section 1) </pre>
<p>
For musical application examples see also {https://opusmodus.com/forums/topic/867-opusmodus-1222292/}. 
 </p>
<p>
NOTE: This function could also be useful for Beethoven like motif condensation, where notes are first turned into rests with this function, and then their preceding notes are extended with length-legato, as demonstrated in the following example. 
 </p>
<p>
</p>
<pre>
    (setf my-motif '((q. c4 e d4 q. e4 e f4) (h g4 -h))) 
     (length-legato 
      (filter-notes-if #'(lambda (dur pitch &amp;rest other-args)   
                           (&gt; (omn-encode dur) 1/4))  
                       my-motif)) 
     =&gt; ((h c4 e4) (w g4)) </pre>
<p>
See also {https://opusmodus.com/forums/topic/910-merge-rests-with-preceeding-note/?tab=comments#comment-2713}. 
 </p>
<p>
</p>
</div>
</div>
<div class="defun">
<div class="defunsignatures">
<a id="_g181331">
</a>
<table cellpadding="0" cellspacing="0" width="100%">
<colgroup span="3">
<col width="0*"/>
<col width="1*"/>
<col width="0*"/>
</colgroup>
<tbody>
<tr>
<td class="symbol-name">
corresponding-rest&nbsp;&nbsp;</td>
<td class="lambda-list">
event</td>
<td class="symbol-type">
&nbsp;[Function]</td>
</tr>
</tbody>
</table>
</div>
<div class="doc-body">
<p>
Turns a single OMN note into a rest of the same note value. Rests remain rests, and rest articulations are preserved. 
 </p>
<p>
Example: 
 </p>
<pre>
    (corresponding-rest '(h c4)) </pre>
</div>
</div>
<div class="defun">
<div class="defunsignatures">
<a id="_g181332">
</a>
<table cellpadding="0" cellspacing="0" width="100%">
<colgroup span="3">
<col width="0*"/>
<col width="1*"/>
<col width="0*"/>
</colgroup>
<tbody>
<tr>
<td class="symbol-name">
_push-event-and-rests&nbsp;&nbsp;</td>
<td class="lambda-list">
event matching-position result-omns articulation-sets-length</td>
<td class="symbol-type">
&nbsp;[Function]</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="defun">
<div class="defunsignatures">
<a id="_g181333">
</a>
<table cellpadding="0" cellspacing="0" width="100%">
<colgroup span="3">
<col width="0*"/>
<col width="1*"/>
<col width="0*"/>
</colgroup>
<tbody>
<tr>
<td class="symbol-name">
separate-parts&nbsp;&nbsp;</td>
<td class="lambda-list">
sequence articulation-sets</td>
<td class="symbol-type">
&nbsp;[Function]</td>
</tr>
</tbody>
</table>
</div>
<div class="doc-body">
<p>
The function `separate-parts' is useful for customising your sound playback with multiple sound libraries or for algorithmic orchestration. 
 The function breaks an OMN sequence (a single part) into a list of multiple OMN sequences (multiple parts). It basically sorts notes from the OMN sequence into different parts, depending on the articulations of individual notes. All notes with certain articulations go in one resulting parts, and notes with other articulations in another part. In all other resulting parts, notes are substituted by rests, so that timing relations of notes in different parts are preserved. 
 This function can be useful, when you have multiple sound libraries that support different articulations of the same instrument. You can then perform notes with certain articulations on one software instrument (on its own MIDI channel etc.), and notes with other articulations on another instrument. 
 Alternatively, you can use the function for algorithmic orchestration, where you assign custom articulations (typically declared with add-text-attributes first) such as instrument labels with your custom algorithm, and then use this function in a second step to separate your instruments. 
 </p>
<p>
Remember that the result of this function is a list of multiple OMN sequences (multiple parts). You have to split it into its individual parts for use in OMN. 
 </p>
<p>
See also {https://opusmodus.com/forums/topic/849-towards-algorithmic-orchestration-and-customising-sound-playback-with-multiple-sound-libraries/}
 </p>
<p>
Args: 
 </p>
<ul>
<li>
<p>
sequence: OMN sequence, can be nested 
 </p>
</li>
<li>
<p>
articulation-sets: list of list of articulations. All notes with articulations contained in the first articulation-set end up in the first resulting part, notes with articulations in the second set end up in the second part and so forth. 
 
 The decision which part a note belongs to is always made based on the first articulation that matches an articulation-set. If a note contains no articulation, or an articulation contained in no set, then it is matched to the first articulation-set. If an articulation is contained in multiple articulation-sets, then the earlier match in articulation-sets is used. 
 </p>
</li>
</ul>
<p>
Examples: 
 </p>
<pre>
    (separate-parts '(h c4 pizz q arco) 
                     '((pizz) 
                       (arco))) 
     =&gt; ((h c4 mf pizz -q)   ; part 1 with pizz articulations 
         (-h q c4 mf arco))  ; part 2 with arco </pre>
<p>
</p>
<pre>
    (separate-parts '((h c4 pizz q arco) (h trem q h pizz) (h arco+stacc -q fermata)) 
                     '((pizz arco) 
                       (trem))) 
     =&gt; (((h c4 mf pizz q arco) (-h q c4 mf h pizz) (h c4 mf arco+stacc -q fermata)) ; part 1: pizz and arco 
         ((-h -q) (h c4 mf trem -q -h) (-h -q fermata)))                             ; part 2: trem </pre>
<p>
Full score example: 
 </p>
<p>
</p>
<pre>
    (setf omn-expr '((h c4 pizz q arco) (h trem q h pizz) (h arco+stacc -q fermata))) 
     (setf parts (separate-parts omn-expr 
                                 '((pizz arco) 
                                   (trem)))) 
     (def-score two-violins 
       (:title &quot;Title&quot; 
     	  :composer &quot;Composer&quot; 
     	  :copyright &quot;Copyright © &quot; 
     	  :key-signature 'chromatic 
     	  :time-signature '((1 1 1 1) 4) 
     	  :tempo 100 
     	  :layout (bracket-group 
     		   (violin1-layout 'violin1) 
     		   (violin2-layout 'violin2))) 
       
       (violin1 
        :omn (nth 0 parts) 
        :channel 1 
        :sound 'gm 
        :program 'violin 
        :volume 100 
        :pan 54 
        :controllers (91 '(48)) 
        ) 
       
       (violin2 
        :omn (nth 1 parts) 
        :channel 2 
        :sound 'gm 
        :program 'violin 
        :volume 100 
        :pan 74 
        :controllers (91 '(60)) 
        ) 
       ) </pre>
</div>
</div>
<div class="defun">
<div class="defunsignatures">
<a id="_g181334">
</a>
<table cellpadding="0" cellspacing="0" width="100%">
<colgroup span="3">
<col width="0*"/>
<col width="1*"/>
<col width="0*"/>
</colgroup>
<tbody>
<tr>
<td class="symbol-name">
insert-articulation&nbsp;&nbsp;</td>
<td class="lambda-list">
flat-omn-list <em>&amp;rest</em> articulations</td>
<td class="symbol-type">
&nbsp;[Function]</td>
</tr>
</tbody>
</table>
</div>
<div class="doc-body">
<p>
Merge in one or more lists of articulations to an OMN expression. 
 </p>
<p>
Example: 
 added nil for the rest 
 </p>
<pre>
    (insert-articulation '(e c4 mp arco e. d4 -h e. p pizz e e4 arco)  
                          '(ponte tasto nil ponte tasto)) 
     =&gt; (e c4 mp arco+ponte e. d4 mp tasto -h e. d4 p pizz+ponte e e4 p arco+tasto) </pre>
<p>
BUG: does not skip rests. Wait for omn-replace supports composite articulations to fix 
 </p>
</div>
</div>
<div class="defun">
<div class="defunsignatures">
<a id="_g181335">
</a>
<table cellpadding="0" cellspacing="0" width="100%">
<colgroup span="3">
<col width="0*"/>
<col width="1*"/>
<col width="0*"/>
</colgroup>
<tbody>
<tr>
<td class="symbol-name">
remove-unless-parameters&nbsp;&nbsp;</td>
<td class="lambda-list">
flat-omn-list parameter <em>&amp;key</em> (remove-non-matching? nil)</td>
<td class="symbol-type">
&nbsp;[Function]</td>
</tr>
</tbody>
</table>
</div>
<div class="doc-body">
<p>
Checks every note whether it contains `parameter'. All notes containing the parameter are preserved, all other notes are turned into rests. If a note contains a combination of articulations, all of them are checked. 
 </p>
<p>
Args: 
 </p>
<ul>
<li>
<p>
flat-omn-list: flat OMN list 
 </p>
</li>
<li>
<p>
parameter: a length, pitch, OMN velocity or single articulation 
 </p>
</li>
<li>
<p>
remove-rests? (default nil): if true, all notes that do not match are removed instead of turned into rests. 
 </p>
</li>
</ul>
<p>
Examples: 
 </p>
<pre>
    (remove-unless-parameters '(e c4 mp arco+ponte e. d4 mp tasto -h e. c4 p pizz+ponte e e4 p arco+tasto)  
                             'e.) 
     =&gt; (-1/8 e. d4 mp tasto -1/2 e. c4 p pizz+ponte -1/8) </pre>
<p>
</p>
<pre>
    (remove-unless-parameters '(e c4 mp arco+ponte e. d4 mp tasto -h e. c4 p pizz+ponte e e4 p arco+tasto)  
                             'arco) 
     =&gt; (e c4 mp arco+ponte -3/16 -1/2 -3/16 e e4 p arco+tasto) </pre>
<p>

 </p>
<pre>
    (remove-unless-parameters '(e c4 mp arco+ponte e. d4 mp tasto -h e. c4 p pizz+ponte e e4 p arco+tasto)  
                              'arco 
                              :remove-non-matching? T) 
     =&gt; (e c4 mp arco+ponte e e4 p arco+tasto) </pre>
<p>

 </p>
</div>
</div>
</div>
<div class="cludg-footer">
Generated by&nbsp;<a href="mailto:ihatchondo@common-lisp.net" lang="en">
CLDOC</a>
- 2017-08-15 20:19:36</div>
</body>
</html>
