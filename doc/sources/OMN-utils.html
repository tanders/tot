<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html>
<head>
<link rel="Stylesheet" type="text/css" href="../cludg.css"/>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"/>
<title>
OMN-utils</title>
</head>
<body>
<div id="navbar">
<table cellspacing="0" cellpadding="0" border="0" style="width: 100%;">
<colgroup span="3">
<col width="0*"/>
<col width="0*"/>
<col width="1*"/>
</colgroup>
<tr>
<td align="left" valign="baseline">
<a href="utils.html">
Prev:&nbsp;utils</a>
<br/>
<a href="score.html">
Next:&nbsp;score</a>
</td>
<td>
&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td align="left" valign="baseline">
<span class="upchain">
<b>
OMN-utils</b>
<br/>
<a href="../index.html">
Index</a>
</span>
&nbsp;&nbsp;&nbsp;&nbsp;</td>
</tr>
</table>
</div>
<div class="cludg-doc-body">
<h2>
OMN-utils
</h2>
<table style="width: 100%;" class="summary-table">
<tr class="table-heading-color">
<th class="summary" colspan="2">
Function summary</th>
</tr>
<tr class="table-row-color">
<td class="summary-name">
<a href="OMN-utils.html#_g237514">
copy-time-signature</a>
</td>
<td class="summary">
music-with-time-signature music-to-rebar</td>
</tr>
<tr class="table-row-color">
<td class="summary-name">
<a href="OMN-utils.html#_g237518">
count-notes</a>
</td>
<td class="summary">
notes</td>
</tr>
<tr class="table-row-color">
<td class="summary-name">
<a href="OMN-utils.html#_g237515">
edit-omn</a>
</td>
<td class="summary">
type notation fun <em>&amp;key</em> (flat nil) (swallow nil) (section nil) (additional-args nil)</td>
</tr>
<tr class="table-row-color">
<td class="summary-name">
<a href="OMN-utils.html#_g237521">
length-add</a>
</td>
<td class="summary">
<em>&amp;rest</em> length-values</td>
</tr>
<tr class="table-row-color">
<td class="summary-name">
<a href="OMN-utils.html#_g237520">
length-subtract</a>
</td>
<td class="summary">
<em>&amp;rest</em> length-values</td>
</tr>
<tr class="table-row-color">
<td class="summary-name">
<a href="OMN-utils.html#_g237517">
note-no</a>
</td>
<td class="summary">
music</td>
</tr>
<tr class="table-row-color">
<td class="summary-name">
<a href="OMN-utils.html#_g237519">
phrase-lengths</a>
</td>
<td class="summary">
lengths</td>
</tr>
<tr class="table-row-color">
<td class="summary-name">
<a href="OMN-utils.html#_g237516">
total-duration</a>
</td>
<td class="summary">
sequence</td>
</tr>
</table>
<div class="defun">
<div class="defunsignatures">
<a id="_g237514">
</a>
<table cellpadding="0" cellspacing="0" width="100%">
<colgroup span="3">
<col width="0*"/>
<col width="1*"/>
<col width="0*"/>
</colgroup>
<tbody>
<tr>
<td class="symbol-name">
copy-time-signature&nbsp;&nbsp;</td>
<td class="lambda-list">
music-with-time-signature music-to-rebar</td>
<td class="symbol-type">
&nbsp;[Function]</td>
</tr>
</tbody>
</table>
</div>
<div class="doc-body">
<p>
Rebars `music-to-rebar' so that it fits the meter of `music-with-time-signature'. 
 </p>
</div>
</div>
<div class="defun">
<div class="defunsignatures">
<a id="_g237515">
</a>
<table cellpadding="0" cellspacing="0" width="100%">
<colgroup span="3">
<col width="0*"/>
<col width="1*"/>
<col width="0*"/>
</colgroup>
<tbody>
<tr>
<td class="symbol-name">
edit-omn&nbsp;&nbsp;</td>
<td class="lambda-list">
type notation fun <em>&amp;key</em> (flat nil) (swallow nil) (section nil) (additional-args nil)</td>
<td class="symbol-type">
&nbsp;[Function]</td>
</tr>
</tbody>
</table>
</div>
<div class="doc-body">
<p>
Use function `fun', defined for transforming individual OMN parameters of `type' (e.g., <span class="keyword">
:length, </span>
or <span class="keyword">
:velocity) </span>
to transform omn expression `notation'. This function is intended as a convenient way to generalise your functions to support omn notation as input. 
 </p>
<p>
Args: 
 </p>
<ul>
<li>
<p>
type: a keyword like <span class="keyword">
:length, </span>
<span class="keyword">
:pitch, </span>
<span class="keyword">
:velocity, </span>
<span class="keyword">
:duration, </span>
or <span class="keyword">
:articulation </span>
(any keyword supported by function omn or make-omn). 
 </p>
</li>
<li>
<p>
fun: a function expecting a parameter sequence of given type. It is sufficient to support only a flat input list, support for nested lists is added implicitly. 
 </p>
</li>
<li>
<p>
notation: a omn sequence or a plain parameter list (can be nested). 
 </p>
</li>
<li>
<p>
flat: whether or not `fun' expects a flat input list. 
 </p>
</li>
<li>
<p>
swallow: if `type' is <span class="keyword">
:length, </span>
and `fun' turns notes into rests, the argument `swallow' sets whether the pitches of these notes should be shifted to the next note or omitted (swallowed). `swallow' is ignored if notation is a plain parameter list (e.g., a 
 </p>
</li>
<li>
<p>
section: only process the sublists (bars) of the positions given to this argument. Arg is ignored if `flat' is T. 
 </p>
</li>
<li>
<p>
additional-args (list of args): `additional-args' allows implementing 'dynamic' arguments, i.e., transformations that change over the sublists of `notation' depending on a list of arguments instead of a plain value. If `additional-args' is nil, then `fun' expects parameter values directly. However, if it is a list, then `fun' expects a list where the parameter values are the first element, and `additional-args' (if `flat' is T) or an element thereof (if `flat' is NIL) the second element in the list expected by `fun'. 
 </p>
</li>
</ul>
<p>
Examples: 
 </p>
<p>
roll your own transposition supporting omn input 
 first aux def supporting only pitches 
 </p>
<pre>
    (defun my-transposition-aux (interval pitches) 
       (midi-to-pitch (loop for p in (pitch-to-midi pitches) 
                            collect (+ p interval)))) </pre>
<p>

 test 
 </p>
<pre>
    (my-transposition-aux 7 '(c4 e4 g4))  
      =&gt; (g4 b4 d5) </pre>
<p>
variant supporting also omn expressions 
 </p>
<pre>
    (defun my-transposition (interval omn) 
       (edit-omn :pitch omn 
                 #'(lambda (ps) (my-transposition-aux interval ps)))) </pre>
<p>
test with nested OMN including a rest 
 </p>
<pre>
    (my-transposition 7 '((q c4 mp -q q e4 q f4) (h g4 tr2))) 
      =&gt; ((q g4 mp - b4 c5) (h d5 mp tr2)) </pre>
<p>
Another example: expand the built-in function `length-rest-series' to support arbitrary OMN expressions (not just length lists), and additionally the arguments `swallow' and `section'. 
 </p>
<p>
</p>
<pre>
    (defun note-rest-series (positions sequence &amp;key (flat nil) (swallow nil) (section nil)) 
       (edit-omn :length sequence  
                 #'(lambda (ls) (length-rest-series positions ls)) 
                 :swallow swallow 
     	        :section section 
     	        :flat flat)) 
      
     (setf melody '((s eb6 &lt; leg f5 &lt; leg c5 &lt; leg f5 &lt; leg) (e e6 f - -q))) 
     (note-rest-series '(1 1) melody :swallow T :section '(0)) </pre>
<p>
The next example demonstrates how 'dynamic' arguments can be implemented, i.e. arguments that support different values for subsections. Below is a simplified definition of the function rotate-omn. Note how the function argument `n' is handed to the argument `additional-args' of `edit-omn' if `n' is a list. The function given to `edit-omn' also tests whether `n' is a list, and in that case extracts the OMN sublist to rotate as first element of the function argument `xs' and the amount of the rotation of this sublist as second element of `xs'. Further 'dynamic' arguments could be implemented by handing `additional-args' a list of argument lists to use, and by then extracting the relevant elements of such sublists within the function given to `edit-omn'. 
 </p>
<p>
</p>
<pre>
    (defun rotate-omn (n sequence &amp;key (parameter :pitch) (flat T) (section nil)) 
       (let ((n-list-arg? (listp n))) 
         (edit-omn parameter sequence 
     	          #'(lambda (xs) 
     		      (if n-list-arg? 
     		          (gen-rotate (second xs) (first xs)) 
     		          (gen-rotate n xs))) 
     	          :section section 
     	          :flat flat 
     	          :additional-args (when n-list-arg? n)))) </pre>
<p>
The function rotate-omn can now be called with either giving a single number or a list of numbers to its argument `n'. 
 </p>
<p>
</p>
<pre>
    (setf melody '((-h e c4 e4) (q. f4 e g4 q a4) (q g4 f4 e e4 d4))) 
      
     (rotate-omn 1 melody) ; default parameter pitch 
      
     (rotate-omn '(0 1 2) melody :flat nil)  
      
     (rotate-omn '(2 1) melody :section '(1 2) :flat nil :parameter :length) </pre>
<p>

 </p>
</div>
</div>
<div class="defun">
<div class="defunsignatures">
<a id="_g237516">
</a>
<table cellpadding="0" cellspacing="0" width="100%">
<colgroup span="3">
<col width="0*"/>
<col width="1*"/>
<col width="0*"/>
</colgroup>
<tbody>
<tr>
<td class="symbol-name">
total-duration&nbsp;&nbsp;</td>
<td class="lambda-list">
sequence</td>
<td class="symbol-type">
&nbsp;[Function]</td>
</tr>
</tbody>
</table>
</div>
<div class="doc-body">
<p>
Return the total duration (sum of all note and rest values) of `sequence'. 
 </p>
</div>
</div>
<div class="defun">
<div class="defunsignatures">
<a id="_g237517">
</a>
<table cellpadding="0" cellspacing="0" width="100%">
<colgroup span="3">
<col width="0*"/>
<col width="1*"/>
<col width="0*"/>
</colgroup>
<tbody>
<tr>
<td class="symbol-name">
note-no&nbsp;&nbsp;</td>
<td class="lambda-list">
music</td>
<td class="symbol-type">
&nbsp;[Function]</td>
</tr>
</tbody>
</table>
</div>
<div class="doc-body">
<p>
Returns the number of notes in music, which is a list of lengths values of OMN expressions. 
 </p>
</div>
</div>
<div class="defun">
<div class="defunsignatures">
<a id="_g237518">
</a>
<table cellpadding="0" cellspacing="0" width="100%">
<colgroup span="3">
<col width="0*"/>
<col width="1*"/>
<col width="0*"/>
</colgroup>
<tbody>
<tr>
<td class="symbol-name">
count-notes&nbsp;&nbsp;</td>
<td class="lambda-list">
notes</td>
<td class="symbol-type">
&nbsp;[Function]</td>
</tr>
</tbody>
</table>
</div>
<div class="doc-body">
<p>
Returns number of notes (ignoring rests) in length list or other OMN expression. 
 </p>
</div>
</div>
<div class="defun">
<div class="defunsignatures">
<a id="_g237519">
</a>
<table cellpadding="0" cellspacing="0" width="100%">
<colgroup span="3">
<col width="0*"/>
<col width="1*"/>
<col width="0*"/>
</colgroup>
<tbody>
<tr>
<td class="symbol-name">
phrase-lengths&nbsp;&nbsp;</td>
<td class="lambda-list">
lengths</td>
<td class="symbol-type">
&nbsp;[Function]</td>
</tr>
</tbody>
</table>
</div>
<div class="doc-body">
<p>
Returns the number of notes between rests in the given lengths. 
 
 Args: 
 </p>
<ul>
<li>
<p>
length: lengths or OMN (list or list of list). 
 </p>
</li>
</ul>
</div>
</div>
<div class="defun">
<div class="defunsignatures">
<a id="_g237520">
</a>
<table cellpadding="0" cellspacing="0" width="100%">
<colgroup span="3">
<col width="0*"/>
<col width="1*"/>
<col width="0*"/>
</colgroup>
<tbody>
<tr>
<td class="symbol-name">
length-subtract&nbsp;&nbsp;</td>
<td class="lambda-list">
<em>&amp;rest</em> length-values</td>
<td class="symbol-type">
&nbsp;[Function]</td>
</tr>
</tbody>
</table>
</div>
<div class="doc-body">
<p>
Subtraction for OMN length values. 
 </p>
<p>
Example: 
 </p>
<pre>
    (length-subtract 'w 'q) 
     =&gt; h. </pre>
<p>

 </p>
</div>
</div>
<div class="defun">
<div class="defunsignatures">
<a id="_g237521">
</a>
<table cellpadding="0" cellspacing="0" width="100%">
<colgroup span="3">
<col width="0*"/>
<col width="1*"/>
<col width="0*"/>
</colgroup>
<tbody>
<tr>
<td class="symbol-name">
length-add&nbsp;&nbsp;</td>
<td class="lambda-list">
<em>&amp;rest</em> length-values</td>
<td class="symbol-type">
&nbsp;[Function]</td>
</tr>
</tbody>
</table>
</div>
<div class="doc-body">
<p>
Addition of OMN length values. 
 </p>
<p>
Example: 
 </p>
<pre>
    (length-add 'w 'q) 
     =&gt; wq </pre>
</div>
</div>
</div>
<div class="cludg-footer">
Generated by&nbsp;<a href="mailto:ihatchondo@common-lisp.net" lang="en">
CLDOC</a>
- 2017-11-09 23:39:59</div>
</body>
</html>
